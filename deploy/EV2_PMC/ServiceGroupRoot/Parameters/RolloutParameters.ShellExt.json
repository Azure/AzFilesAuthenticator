{
  "$schema": "https://ev2schema.azure.net/schemas/2020-01-01/rolloutParameters.json",
  "contentVersion": "1.0.0.0",
  "shellExtensions": [
    {
      "name": "PMCPublish",
      "type": "Ubuntu20",
      "properties": {
        "maxExecutionTime": "PT50M",
        "useFallBackLocations": true,
        "skipDeleteAfterExecution": false
      },
      "package": {
        "reference": {
          "path": "Packages/ShellExt/pmc_packages.tar"
        }
      },
      "launch": {
        "command": ["/bin/sh", "-c", "chmod +x start.sh && ./start.sh"],
        "environmentVariables": [
          { "name": "PMC_REPO_NAME", "value": "__PMC_REPO_NAME__" },
          { "name": "PMC_REPO_DIST", "value": "__PMC_REPO_DIST__" }
        ],
        "identity": {
          "type": "UserAssigned",
          "userAssignedIdentities": [
            "/subscriptions/__SUBSCRIPTION_ID__/resourceGroups/__PMC_MSI_RG__/providers/Microsoft.ManagedIdentity/userAssignedIdentities/__PMC_MSI_NAME__"
          ]
        }
      }
    },
    {
      "name": "PMCRollback",
      "type": "Ubuntu20",
      "properties": {
        "maxExecutionTime": "PT50M",
        "useFallBackLocations": true,
        "skipDeleteAfterExecution": false
      },
      "package": {
        "reference": {
          "path": "Packages/ShellExt/pmc_packages.tar"
        }
      },
      "launch": {
        "command": ["/bin/sh", "-c", "chmod +x start.sh && ./start.sh rollback"],
        "environmentVariables": [
          { "name": "PMC_REPO_NAME", "value": "__PMC_REPO_NAME__" },
          { "name": "PMC_REPO_DIST", "value": "__PMC_REPO_DIST__" }
        ],
        "identity": {
          "type": "UserAssigned",
          "userAssignedIdentities": [
            "/subscriptions/__SUBSCRIPTION_ID__/resourceGroups/__PMC_MSI_RG__/providers/Microsoft.ManagedIdentity/userAssignedIdentities/__PMC_MSI_NAME__"
          ]
        }
      }
    }
  ]
}
